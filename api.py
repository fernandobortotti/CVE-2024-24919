import requests
import base64

api_key = 'coloquesuakeyaqui'

query = 'product.name="Check Point SSL Network Extender" and web.title=="Check Point SSL Network Extender" and ip.port=="80"'
encoded_query = base64.urlsafe_b64encode(query.encode("utf-8")).decode('ascii')
start_time = '2024-01-01'
end_time = '2024-05-01'

page = 1
page_size = 100  # Ajuste o tamanho da página conforme necessário
all_results = []

while True:
    url = "https://api.hunter.how/search?api-key=%s&query=%s&page=%d&page_size=%d&start_time=%s&end_time=%s" % (
        api_key, encoded_query, page, page_size, start_time, end_time
    )
    
    r = requests.get(url)
    data = r.json()
    
    if data['code'] == 200:
        results = data['data']['list']
        all_results.extend(results)
        
        total_results = data['data']['total']
        current_count = len(all_results)
        
        if current_count >= total_results:
            break
        
        page += 1
    else:
        print("Erro ao obter resultados: ", data['message'])
        break

# Salvar todos os IPs em um arquivo
with open('ips.txt', 'w') as file:
    for result in all_results:
        ip = result['ip']
        file.write(ip + '\n')

print("IPs salvos em 'ips.txt'")
